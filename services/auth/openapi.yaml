openapi: 3.1.0
info:
  title: Auth Service
  version: 0.0.1
components:
  securitySchemes:
    Bearer:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas: {}
  parameters: {}
paths:
  /health:
    get:
      responses:
        "200":
          description: Health check response
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  service:
                    type: string
                required:
                  - status
                  - service
  /oauth/google:
    get:
      responses:
        "302":
          description: Redirect to Google
  /oauth/google/callback:
    get:
      parameters:
        - schema:
            type: string
          required: true
          name: code
          in: query
        - schema:
            type: string
          required: true
          name: state
          in: query
      responses:
        "200":
          description: OAuth tokens and user info
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                  refresh_token:
                    type: string
                  token_type:
                    type: string
                    enum:
                      - Bearer
                  expires_in:
                    type: number
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                      email:
                        type: string
                      name:
                        type: string
                      role:
                        type: string
                    required:
                      - id
                      - email
                      - name
                      - role
                required:
                  - access_token
                  - refresh_token
                  - token_type
                  - expires_in
                  - user
        "400":
          description: OAuth error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
  /token:
    post:
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                grant_type:
                  type: string
                  enum:
                    - client_credentials
                api_key:
                  type: string
                  minLength: 1
                on_behalf_of:
                  type: string
              required:
                - grant_type
                - api_key
      responses:
        "200":
          description: Access token issued
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                  token_type:
                    type: string
                    enum:
                      - Bearer
                  expires_in:
                    type: number
                required:
                  - access_token
                  - token_type
                  - expires_in
        "400":
          description: Invalid grant type
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
        "401":
          description: Invalid API key
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
    delete:
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                refresh_token:
                  type: string
                  minLength: 1
              required:
                - refresh_token
      responses:
        "204":
          description: Token revoked
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
  /token/refresh:
    post:
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                refresh_token:
                  type: string
                  minLength: 1
              required:
                - refresh_token
      responses:
        "200":
          description: Tokens refreshed
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                  refresh_token:
                    type: string
                  token_type:
                    type: string
                    enum:
                      - Bearer
                  expires_in:
                    type: number
                required:
                  - access_token
                  - refresh_token
                  - token_type
                  - expires_in
        "401":
          description: Invalid refresh token
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
        "404":
          description: User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
  /me:
    get:
      security:
        - Bearer: []
      responses:
        "200":
          description: Current user info
          content:
            application/json:
              schema:
                anyOf:
                  - type: object
                    properties:
                      id:
                        type: string
                      email:
                        type: string
                      name:
                        type: string
                      role:
                        type: string
                      created_at:
                        type: string
                    required:
                      - id
                      - email
                      - name
                      - role
                      - created_at
                  - type: object
                    properties:
                      sub:
                        type: string
                      ct:
                        type: string
                        enum:
                          - tp
                      org:
                        type: string
                      scp:
                        type: array
                        items:
                          type: string
                    required:
                      - sub
                      - ct
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
        "404":
          description: User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
  /.well-known/jwks.json:
    get:
      responses:
        "200":
          description: JSON Web Key Set
          content:
            application/json:
              schema:
                type: object
                properties:
                  keys:
                    type: array
                    items:
                      type: object
                      additionalProperties: {}
                required:
                  - keys
  /orgs:
    post:
      security:
        - Bearer: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                contact_email:
                  type: string
                  format: email
                scopes:
                  type: array
                  items:
                    type: string
              required:
                - name
                - contact_email
                - scopes
      responses:
        "201":
          description: Organization created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  name:
                    type: string
                  contact_email:
                    type: string
                  scopes:
                    type: array
                    items:
                      type: string
                  owner_id:
                    type: string
                    format: uuid
                  created_at:
                    type: string
                required:
                  - id
                  - name
                  - contact_email
                  - scopes
                  - owner_id
                  - created_at
        "400":
          description: Invalid scopes
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
  /orgs/{orgId}:
    get:
      security:
        - Bearer: []
      parameters:
        - schema:
            type: string
            format: uuid
          required: true
          name: orgId
          in: path
      responses:
        "200":
          description: Organization details
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  name:
                    type: string
                  contact_email:
                    type: string
                  scopes:
                    type: array
                    items:
                      type: string
                  owner_id:
                    type: string
                    format: uuid
                  created_at:
                    type: string
                  updated_at:
                    type:
                      - string
                      - "null"
                required:
                  - id
                  - name
                  - contact_email
                  - scopes
                  - owner_id
                  - created_at
                  - updated_at
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
        "404":
          description: Organization not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
    patch:
      security:
        - Bearer: []
      parameters:
        - schema:
            type: string
            format: uuid
          required: true
          name: orgId
          in: path
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                contact_email:
                  type: string
                  format: email
                scopes:
                  type: array
                  items:
                    type: string
      responses:
        "200":
          description: Organization updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  name:
                    type: string
                  contact_email:
                    type: string
                  scopes:
                    type: array
                    items:
                      type: string
                  owner_id:
                    type: string
                    format: uuid
                  created_at:
                    type: string
                  updated_at:
                    type:
                      - string
                      - "null"
                required:
                  - id
                  - name
                  - contact_email
                  - scopes
                  - owner_id
                  - created_at
                  - updated_at
        "400":
          description: Invalid scopes
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
        "404":
          description: Organization not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
  /orgs/{orgId}/api-keys:
    post:
      security:
        - Bearer: []
      parameters:
        - schema:
            type: string
            format: uuid
          required: true
          name: orgId
          in: path
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                label:
                  type: string
                scopes:
                  type: array
                  items:
                    type: string
              required:
                - scopes
      responses:
        "201":
          description: API key created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  key:
                    type: string
                  key_prefix:
                    type: string
                  label:
                    type:
                      - string
                      - "null"
                  scopes:
                    type: array
                    items:
                      type: string
                  created_at:
                    type: string
                required:
                  - id
                  - key
                  - key_prefix
                  - label
                  - scopes
                  - created_at
        "400":
          description: Invalid scopes
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
        "404":
          description: Organization not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
    get:
      security:
        - Bearer: []
      parameters:
        - schema:
            type: string
            format: uuid
          required: true
          name: orgId
          in: path
      responses:
        "200":
          description: List of API keys
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                    key_prefix:
                      type: string
                    label:
                      type:
                        - string
                        - "null"
                    scopes:
                      type: array
                      items:
                        type: string
                    expires_at:
                      type:
                        - string
                        - "null"
                    last_used_at:
                      type:
                        - string
                        - "null"
                    created_at:
                      type: string
                  required:
                    - id
                    - key_prefix
                    - label
                    - scopes
                    - expires_at
                    - last_used_at
                    - created_at
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
        "404":
          description: Organization not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
  /orgs/{orgId}/api-keys/{keyId}:
    delete:
      security:
        - Bearer: []
      parameters:
        - schema:
            type: string
            format: uuid
          required: true
          name: orgId
          in: path
        - schema:
            type: string
            format: uuid
          required: true
          name: keyId
          in: path
      responses:
        "204":
          description: API key revoked
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
        "404":
          description: API key not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                  - error
                  - message
webhooks: {}
